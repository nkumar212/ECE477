<html>
<head>
<script>

//Constants
var KEY_W = 1;
var KEY_A = 2;
var KEY_S = 4;
var KEY_D = 8;
var KEY_SPACE = 16;

var ws = new WebSocket("ws://localhost:9999/");

ws.onopen = function() {
};

//Global variable holding which gKeys are down
var gKeys = 0;

ws.onopen = function(){

	ws.send('Hello from the client!');
	
	canvas = document.getElementById("canvas");
	output = document.getElementById("output");
	robotid = document.getElementById("robotid").value;

	canvas.onload = function(){
		gKeys = 0;
	}

	canvas.onfocus = function(){
		gKeys = 0;
	}

	canvas.onblur = function(){
		gKeys = 0;
	}

	canvas.onkeyup = function(e){
		if(e == null) e = window.event;
		key = e.keyCode;

		if(key == 65) //A
			gKeys &= 0xFFFF ^ KEY_A
		else if(key == 83) //S
			gKeys &= 0xFFFF ^ KEY_S
		else if(key == 68) //D
			gKeys &= 0xFFFF ^ KEY_D
		else if(key == 87) //W
			gKeys &= 0xFFFF ^ KEY_W
		else if(key == 32) //Space
			gKeys &= 0xFFFF ^ KEY_SPACE
	}

	canvas.onkeydown = function(e){
		if(e == null) e = window.event;
		key = e.keyCode;

		if(key == 65) //A
			gKeys |= KEY_A
		else if(key == 83) //S
			gKeys |= KEY_S
		else if(key == 68) //D
			gKeys |= KEY_D
		else if(key == 87) //W
			gKeys |= KEY_W
		else if(key == 32) //Space
			gKeys |= KEY_SPACE
	}

	function getKeys(){
		setTimeout(function() {
			msg = robotid + " " + gKeys + "\n";
			output.value = msg;
			ws.send(msg);
		
			getKeys();
		},100);
	}

	getKeys();
}

</script>
</head>
<body style="background-color:black;">
<canvas tabindex=1 style="background-color:white;border: thin red solid;" width=640 height=480 id="canvas"></canvas>
<input type="hidden" id="robotid" value="MINOTAUR_1" />
<input type="text" id="output" />
</body>
</html>
